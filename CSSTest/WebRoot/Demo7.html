<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>购物车</title>
<style type="text/css">
	td{
		text-align: center;
	}
	#outer{
		text-align: center;
		position: absolute;
		left: 50%;
		top: 50%;
		width: 300px;
		height: 200px;
		margin-left: -150px;
		margin-top: -100px;
		display: table;
		
	}
	#mainTB{
		display: table-cell;
		vertical-align: middle;
	}
	#delmsg{
		font-size: 3px;
		color: #f00;
		background-color: #ff0;
		text-align: center;
		width: 200px;
		position: absolute;
		left: 50%;
		margin-left: -100px;
		visibility: hidden;
		}
	
</style>
<script type="text/javascript">
	function add(loc){
		var kucun=parseInt(loc.parentNode.parentNode.cells[loc.parentNode.cellIndex+1].innerHTML);
		var nowNum = parseInt(loc.previousSibling.value);
		loc.previousSibling.value=Math.min(nowNum+1,kucun);
	}
	
	function de(loc){
		var nowNum = parseInt(loc.nextSibling.value);
		nowNum=Math.max(1,nowNum-1);
		
		loc.nextSibling.value=nowNum;
	}
	
	function del(loc){
		if (window.confirm("是否删除")){
			//loc.parentNode.parentNode.parentNode.removeChild(loc.parentNode.parentNode);
			var index=loc.parentNode.parentNode.rowIndex;
			var name=loc.parentNode.parentNode.cells[1].innerHTML;
			var table=loc.parentNode.parentNode.parentNode.parentNode;
			var row=table.rows[index];
			loc.parentNode.parentNode.parentNode.parentNode.deleteRow(index);
			showDelMsg(name, row, table, index);
		}
	}
	var _row,_table,_index;
	function showDelMsg(name,row,table,index){
		_row=row;
		_table=table;
		_index=index;
		var msgHTML="成功删除商品"+name+"&nbsp <a href='javascript:void(0)' onclick='undo()'>撤销</a>";
		document.getElementById("delmsg").innerHTML=msgHTML;
		document.getElementById("delmsg").style.visibility="visible"
		setTimeout(function() {
			document.getElementById("delmsg").style.visibility="hidden";
		}, 3000);
	}
	
	function undo(){
		_table.insertRow(_index);
		_table.rows[_index]=_row;
	}
	
	function check(loc){
		var kucun=parseInt(loc.parentNode.parentNode.cells[loc.parentNode.cellIndex+1].innerHTML);
		var nowNum = parseInt(loc.value);
		if (nowNum > kucun){
			loc.value=kucun;
		}else if(nowNum < 0){
			loc.value=0;
		}
	}
</script>
</head>
<body>
<div id="delmsg">
	测试消息
</div>
<div id="outer">
<div id="mainTB">
<table border="1" align="center" id="gouwuche">
	<th>编号</th>
	<th>名称</th>
	<th>数量</th>
	<th>库存</th>
	<th>操作</th>
	<tr>
		<td>1</td>
		<td>电视机</td>
		<td>
			<input type="button" value="-" onclick="de(this);"><input type="text" value="3" size="3" name="tv_num" style="text-align: center" onblur="check(this);"><input type="button" value="+" onclick="add(this);">
		</td>
		<td>10</td>
		<td><a href="javascript:void(0)" onclick="del(this);">删除</a></td>
	</tr>
	<tr>
		<td>2</td>
		<td>电脑</td>
		<td>
			<input type="button" value="-" onclick="de(this);"><input type="text" value="1" size="3" name="pc_num" style="text-align: center" onblur="check(this);"><input type="button" value="+" onclick="add(this);">
		</td>
		<td>15</td>
		<td><a href="javascript:void(0)" onclick="del(this);">删除</a></td>
	</tr>
</table>
</div>
</div>
</body>
</html>